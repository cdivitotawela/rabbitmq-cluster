[ default ]
SAN                             = DNS:mq.rabbit.ops

[ ca ]
default_ca                      = ca_intermediate

[ ca_intermediate ]
dir                             = ./intermediate-ca
certs                           = $dir/certs
crl_dir                         = $dir/crl
new_certs_dir                   = $dir/newcerts
database                        = $dir/index.txt
serial                          = $dir/serial
RANDFILE                        = $dir/private/.rand
policy                          = policy_loose
default_md                      = sha256
private_key                     = $dir/private/ca-intermediate.key.pem
certificate                     = $dir/certs/ca-intermediate.crt.pem

[ policy_loose ]
countryName                     = optional
stateOrProvinceName             = optional
organizationName                = optional
organizationalUnitName          = optional
commonName                      = supplied
emailAddress                    = optional

[ req ]
default_bits                    = 2048
distinguished_name              = req_distinguished_name
string_mask                     = utf8only
default_md                      = sha256
x509_extensions                 = v3_intermediate_ca

[ v3_intermediate_ca ]
subjectKeyIdentifier            = hash
authorityKeyIdentifier          = keyid:always,issuer
basicConstraints                = critical, CA:true, pathlen:0
keyUsage                        = critical, digitalSignature, cRLSign, keyCertSign


[ req_distinguished_name ]
countryName                     = Country Name (2 letter code)
stateOrProvinceName             = State or Province Name
localityName                    = Locality Name
0.organizationName              = Organization Name
organizationalUnitName          = Organizational Unit Name
commonName                      = Common Name
emailAddress                    = Email Address

# Optionally, specify some defaults.
countryName_default             = AU
stateOrProvinceName_default     = Queensland
localityName_default            = Brisbane
0.organizationName_default      = RabbitMQ
organizationalUnitName_default  = DevOps
emailAddress_default            = admin@rabbit.ops

[ usr_cert ]
basicConstraints                = CA:FALSE
nsCertType                      = client
nsComment                       = "RabbitMQ client certificate"
subjectKeyIdentifier            = hash
authorityKeyIdentifier          = keyid,issuer
keyUsage                        = critical, nonRepudiation, digitalSignature, keyEncipherment
extendedKeyUsage                = clientAuth

[ server_cert ]
basicConstraints                = CA:FALSE
nsCertType                      = server
nsComment                       = "RabbitMQ server certificate"
subjectKeyIdentifier            = hash
authorityKeyIdentifier          = keyid,issuer:always
keyUsage                        = critical, digitalSignature, keyEncipherment
extendedKeyUsage                = serverAuth
subjectAltName                  = ${ENV::SAN}

#[ alternate_names ]
#DNS.1=mq.rabbit.ops
#DNS.2=${ENV::SAN}

[ mgt_cert ]
basicConstraints = CA:FALSE
nsCertType = server
nsComment = "RabbitMQ server certificate"
subjectKeyIdentifier = hash
authorityKeyIdentifier = keyid,issuer:always
keyUsage = critical, digitalSignature, keyEncipherment
extendedKeyUsage = serverAuth
